pico-8 cartridge // http://www.pico-8.com
version 18
__lua__


alt=16

tw=20    //tile width
th=tw/2  //tile height
htw=tw/2 //half tile width
hth=th/2 //half tile height
xzero=63 //center pixel


tiles={
 {1,1,1,1,1,1},
 {1,0,0,0,0,1},
 {1,0,0,0,0,1},
 {1,0,0,0,0,1},
 {1,0,0,0,0,1},
 {1,1,1,1,1,1},
}

function iso2screen(x,y)
-- xs = 2x,x
-- ys = -2y,y
-- s  = 2x-2y,x+y
 return htw*x-htw*y,hth*x+hth*y
end
--
--function screen2iso(sx,sy)
-- sx-=xzero
-- --local x,y=sx/htw,sy/hth
-- --return flr((x+y)/2),flr((y-x)/2)
-- local x,y=sx/tw,sy/th
-- return flr(x+y),flr(y-x)
--end

function bbtile(sx,sy)
 return flr(sx/tw),flr(sy/th)
end
function bblocal(sx,sy) 
 return sx%tw,sy%th
end

function screen2iso(sx,sy)
 local bx,by=bbtile(sx,sy)
 local lx,ly=bblocal(sx,sy)
 local ix,iy=bx+by,by-bx
 col=sget(104+lx,ly)
 if (col==0) ix-=1
 if (col==1) ix+=1
 if (col==2) iy-=1
 if (col==3) iy+=1
 return ix,iy
end

function _init()
 init_mouse()
 
 cols={}
 for x=-20,20 do
  row={}
  for y=-20,20 do
   row[y]=rnd(16)
  end
  cols[x]=row
 end
end

function _draw()

 cls()
 
 
 
 
 
 --a little faster
-- for x=0,63 do
--  for y=0,127 do
--   tx,ty=screen2iso(x*2,y)
--   srand(tx+ty*100)
--   srand(tx+ty*100)
--   poke(0x6000+x+y*64,rnd(256))
--  end
-- end
 
 if (testmode==nil) testmode=true
 if (btnp(❎)) testmode=not testmode
 
 if (outline==nil) outline=true
 if (btnp(🅾️)) outline=not outline
 
 if testmode then
 
	 for x=0,127 do
	  for y=0,64 do --half screen for more fps for now
	   tx,ty=screen2iso(x,y)
	   pset(x,y,cols[tx][ty])
	  end
	 end
	 
 else
 
	 for x=1,#tiles do
	  for y=1,#tiles[1] do
	   local sx,sy=iso2screen(x-1,y-1)
	   spr(39,sx,sy,3,2)
	  end
	 end
	 
 end
 
 if outline then
 
	 for x=1,#tiles do
	  for y=1,#tiles[1] do
	   local sx,sy=iso2screen(x-1,y-1)
	   spr(42,sx,sy,3,2)
	  end
	 end
	 
 end
 
-- 
-- 
-- for x=0,8 do
--  for y=0,8 do
--   spr(2,x*16,y*16,2,2)
--  end
-- end
-- 
---- pal(11,12)
---- for x=0,8 do
----  for y=0,8 do
----   spr(64,x*16,y*16-alt,2,2)
----  end
---- end
---- pal()
--
-- if (btnp(⬆️)) alt+=1
-- if (btnp(⬇️)) alt-=1
--
-- spr(100,64,64,2,2)
-- spr(98,64,64-alt,2,2)
-- 
-- if alt>8 then
----  spr(96,64,64-8,2,\
--  rectfill2(64+7-1,64+7-10,3,3,9)
--  pset(64+7,64+7,9)
--  pset(64+7,64+7-2,9)
--  pset(64+7,64+7-4,9)
--  pset(64+7,64+7-6,9)
----  line(64+7,64+7-3,64+7,64+7-4)
----  line(64+7,64+7-1,64+7,64+7)
-- end
-- rectfill(0,0,30,30,14)
-- rectfill(0,0,10,10,col)
 color(7)
 local mx,my=get_mouse()
 local tx,ty=screen2iso(mx,my)
 dprint(mx..","..my,0,0)
 dprint(tx..","..ty,0,6)
 spr(16,mx,my)
 
-- rect2(bx*tw-1,by*th-1,tw+2,th+2,7)
-- rect2(bx*tw-2,by*th-2,tw+4,th+4,1)
 
-- pset(lx,ly,0)
 
 
-- print(stat(1))
-- print(stat(7))

end

function dprint(str,x,y,col)
 if (col==nil) col=7
 print(str,x+1,y+1,0)
 print(str,x,y+1,0)
 print(str,x,y,col)
end
function rect2(x,y,w,h,c)
 rect(x,y,x+w-1,y+h-1,c)
end
function rectfill2(x,y,w,h,c)
 rectfill(x,y,x+w-1,y+h-1,c)
end
-->8
--mouse

--mouse down coords
mdx=0
mdy=0
mdrag = false

-- middle or even right mouse
-- clicks might be iffy on web?
lmwasdown=false
rmwasdown=false
mmwasdown=false

function init_mouse()
 poke(0x5f2d, 1) --enable mouse
end

function get_mouse()
 return stat(32)-1, stat(33)-1
end

function cache_mouse_state()
 --for mouse edge triggers
 lmwasdown=lmouse()
	rmwasdown=rmouse()
	mmwasdown=mmouse()
end

function nmouse() return stat(34)==0 end
function lmouse() return stat(34)==1 end
function rmouse() return stat(34)==2 end
function mmouse() return stat(34)==4 end

function lmup() return not lmouse() and lmwasdown end
function rmup() return not rmouse() and rmwasdown end
function mmup() return not mmouse() and mmwasdown end

function lmdown() return lmouse() and not lmwasdown end
function rmdown() return rmouse() and not rmwasdown end
function mmdown() return mmouse() and not mmwasdown end

--can delete
function debug_print_mouse()
 print(mx)
 print(my)
 print("lmup"..tostr(lmup()))
 print("lmdown"..tostr(lmdown()))
 print("lmouse"..tostr(lmouse()))
end
-->8
--util



function near(num)
 if num>0 then return flr(num+0.5) 
 else return ceil(num-0.5) 
 end
end
__gfx__
0000000000000000bb33333333333333000000000000000000000000111111111100222222222200444444443344444444000000000000007777222222220000
000000000000880033bb3333333333bb000000000000000000000000111111110000002222222200444444333333444444070000000000777777772222220000
00700700800088003333bb333333bb33000000000000000000000000111111000000000022222200444433333333334444000000000077777777777722220000
0007700021122226333333bb33bb3333000000000000000000000000111100000000000000222200443333333333333344070000007777777777777777220000
000770008222882633333333bb33333300000000bb00000000000000110000000000000000002200333333333333333333000000777777777777777777770000
0070070080008800333333bb33bb3333000000bb33bb000000000000000000000000000000000000333333333333333333070000337777777777777777110000
00000000000088003333bb333333bb330000bb333333bb0000000000330000000000000000004400bb33333333333333bb000000333377777777777711110000
000000000000000033bb3333333333bb00bb3333333333bb00000000333300000000000000444400bbbb3333333333bbbb070000333333777777771111110000
7777000000000000bb33333333333333bb33333333333333bb000000333333000000000044444400bbbbbb333333bbbbbb000000333333337777111111110000
700000000000000033bb3333333333bb00bb3333333333bb00000000333333330000004444444400bbbbbbbb33bbbbbbbb070000333333333311111111110000
70000000000000003333bb333333bb330000bb333333bb0000000000333333333300444444444400000000000000000000000000000000000000000000000000
7000000000000000333333bb33bb3333000000bb33bb000000000000000000000000000000000000070707070707070707000000000000000000000000000000
000000000000000033333333bb33333300000000bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000333333bb33bb3333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000003333bb333333bb33000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000033bb3333333333bb000000000000000000000000000000000000000000000000000000000b00000000000000000000000000000000000000
0000000000000000bb0000000000000000000000333300000000000000000000b3330000000000000000000bb0000000000000007777777777bb777777770000
000000000000000000bb0000000000bb000000333333330000000000000000b3333333000000000000000bb0000000000000000077777777bb33bb7777770700
00000000000000000000bb000000bb000000333333333333000000000000b3333333333300000000000bb0000000000000000000777777bb333333bb77770000
0000000000000000000000bb00bb000000333333333333333300000000b3333333333333330000000bb0000000000000000000007777bb3333333333bb770700
000000000000000000000000bb000000b33333333333333333330000b33333333333333333330000b0000000000000000000000077bb33333333333333bb0000
0000000000000000000000bb00bb000000333333333333333300000000b3333333333333330000000bb000000000000000000000bb3333333333333333330700
00000000000000000000bb000000bb000000333333333333000000000000b3333333333300000000000bb0000000000000000000449933333333333333990000
000000000000000000bb0000000000bb000000333333330000000000000000b3333333000000000000000bb00000000000000000444499333333333399440700
0000000000000000bb0000000000000000000000333300000000000000000000b3330000000000000000000bb000000000000000444444993333339944440000
000000000000000000bb0000000000bb000000000000000000000000000000000000000000000000000000000b00000000000000444444449933994444440700
00000000000000000000bb000000bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000bb00bb0000000000000000000000000000000000000000000000000000000000000000000000000000070707070707070707070000
000000000000000000000000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000bb00bb0000000000000000000000000000000000000000000000000000000000000000000000000000000700070007000700070000
00000000000000000000bb000000bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000bb0000000000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bb0000000000bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000bb000000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000bb00bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000bb00bb00000000088800660000000088880066000000000000000000000000000000000000000880000000000000088000066600000000000000000000
0000bb000000bb000000008880266000000000882226600000000880000220000000088002200000000888800220000000088880022600000000000000000000
00bb0000000000bb0000000822226000000000222226600000000008822000000000000880000000000008822220000000000882222600000000000000000000
bb000000000000000000080222880000000022222800000000000002288000000000022008800000000002228880000000080222888000000000000000000000
00bb0000000000bb0000082220888000002222288888000000000220000880000002200000000000000222200888800008282220088880000000000000000000
0000bb000000bb000000008000088000000022000088000000022000000000000000000000000000000220000008800000222000000880000000000000000000
000000bb00bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000088000000000000000000000000000
00000000bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000bb00bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000bb000000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bb0000000000bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000008080000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000002200000088000000110000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000099900000000088222088888000001111101111100000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000999990000000000022228800000000001111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000999990000000000088266600000000001111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000099900000000008888066600000000111101100000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000008800066600000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000330000000000000000000000000000000033332222222222222222550000000000000000999999999999999555666666666666aa0000000000000000
000000333333000000000000000000000000000033333333222222222222555500000000000000004499999999999555555566666666aaaa0000000000000000
0000333333333300000000000000000000000033333333333322222222555555000000000000000044449999999555555555556666aaaaaa0000000000000000
00333333333333330000000000000000000033333333333333332222555555550000000000000000444444999555555555555555aaaaaaaa0000000000000000
33333333333333333300000000000000003333333333333333333355555555550000000000000000444444bbb555555555555555aaaaaaaa0000000000000000
333333333333333333000000000000003333333333333333333333555555555500000000000000004444bbbbbbb55555555555eeeeaaaaaa0000000000000000
0033333333333333000000000000000044333333333333333333445555555555000000000000000044bbbbbbbbbbb5555555eeeeeeeeaaaa0000000000000000
00003333333333000000000000000000444433333333333333444444555555550000000000000000bbbbbbbbbbbbbbb555eeeeeeeeeeeeaa0000000000000000
00000033333300000000000000000000444444333333333344444444445555550000000000000000bbbbbbbbbbbbbbb999eeeeeeeeeeeecc0000000000000000
0000000033000000000000000000000044444444333333444444444444445555000000000000000066bbbbbbbbbbb9999999eeeeeeeecccc0000000000000000
000000000000000000000000000000004444444444334444444444444444445500000000000000006666bbbbbbb99999999999eeeecccccc0000000000000000
00000000000000000000000000000000444444444455444444444444444444330000000000000000666666bbb999999999999999cccccccc0000000000000000
00000000000000000000000000000000444444445555554444444444444433330000000000000000666666ddd999999000999999cccccccc0000000000000000
000000000000000000000000000000004444445555555555444444444433333300000000000000006666ddddddd99009990099ffffcccccc0000000000000000
0000000000000000000000000000000044445555555555555544444433333333000000000000000066ddddddddd00999999900ffffffcccc0000000000000000
00000000000000000000000000000000445555555555555555554433333333330000000000000000ddddddddd00dddd999ffff00ffffffcc0000000000000000
00000000b33300000000000000000000555555555555555555555533333333330000000000000000ddddddddd00dddd555ffff00ffffffaa0000000000000000
000000b333333300000000000000000000000000000000000000000033333333000000000000000044ddddddd0d00555555500f0ffffaaaa0000000000000000
0000b3333333333300000000000000000000000000000000000000000033333300000000000000004444ddddd0d55005550055f0ffaaaaaa0000000000000000
00b33333333333333300000000000000000000000000000000000000000003330000000000000000444444ddd055555000555550aaaaaaaa0000000000000000
b3333333333333333333000000000000000000000000000000000000000000000000000000000000444444bbb055555505555550aaaaaaaa0000000000000000
00b333333333333333000000000000000000000000000000000000000000000000000000000000004444bbbbbbb55555055555eeeeaaaaaa0000000000000000
0000b33333333333000000000000000000000000000000000000000000000000000000000000000044bbbbbbbbbbb5550555eeeeeeeeaaaa0000000000000000
000000b3333333000000000000000000000000000000000000000000000000000000000000000000bbbbbbbbbbbbbbb505eeeeeeeeeeeeaa0000000000000000
00000000b33300000000000000000000000000000000000000000000000000000000000000000000bbbbbbbbbbbbbbb999eeeeeeeeeeeecc0000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000066bbbbbbbbbbb9999999eeeeeeeecccc0000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000006666bbbbbbb99999999999eeeecccccc0000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000666666bbb999999999999999cccccccc0000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000666666ddd999999999999999cccccccc0000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000006666ddddddd99999999999ffffcccccc0000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000066ddddddddddd9999999ffffffffcccc0000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000ddddddddddddddd999ffffffffffffcc0000000000000000
111111111100222222222222222222000000000000000000bbbbbbbbbb33bbbbbbbbbbbbbbbbbb33000000004444444444334444444444444444443300000000
111111110000002222222222222200000000000000000000bbbbbbbb333333bbbbbbbbbbbbbb3333000000004444444433333344444444444444333300000000
111111000000000022222222220000000000000000000000bbbbbb3333333333bbbbbbbbbb333333000000004444443333333333444444444433333300000000
111100000000000000222222000000000000000000000000bbbb33333333333333bbbbbb33333333000000004444333333333333334444443333333300000000
110000000000000000002200000000000000000000000000bb333333333333333333bb3333333333000000004433333333333333333344333333333300000000
0000000000000000000000000000000000000000000000003333333333333333333333333333333300000000bb333333333333333333bb333333333300000000
330000000000000000004400000000000000000000000000bb333333333333333333bb333333333300000000bbbb33333333333333bbbbbb3333333300000000
333300000000000000444444000000000000000000000000bbbb33333333333333bbbbbb3333333300000000bbbbbb3333333333bbbbbbbbbb33333300000000
333333000000000044444444440000000000000000000000bbbbbb3333333333bbbbbbbbbb33333300000000bbbbbbbb333333bbbbbbbbbbbbbb333300000000
333333330000004444444444444400000000000000000000bbbbbbbb333333bbbbbbbbbbbbbb333300000000bbbbbbbbbb33bbbbbbbbbbbbbbbbbb3300000000
333333333300444444444444444444000000000000000000bbbbbbbbbb33bbbbbbbbbbbbbbbbbb3300000000bbbbbbbbbb99bbbbbbbbbbbbbbbbbb3300000000
333333330000004444444444444400000000000000000000bbbbbbbb333333bbbbbbbbbbbbbb333300000000bbbbbbbb999999bbbbbbbbbbbbbb333300000000
333333000000000044444444440000000000000000000000bbbbbb3333333333bbbbbbbbbb33333300000000bbbbbb9999999999bbbbbbbbbb33333300000000
333300000000000000444444000000000000000000000000bbbb33333333333333bbbbbb3333333300000000bbbb99999999999999bbbbbb3333333300000000
330000000000000000004400000000000000000000000000bb333333333333333333bb333333333300000000bb999999999999999999bb333333333300000000
0000000000000000000000000000000000000000000000003333333333333333333333333333333300000000dd99999999999999999988333333333300000000
222222221111333333330000000000000000000000000000bb333333333333333333bb333333333300000000dddd999999999999998888883333333300000000
222222111111113333330000000000000000000000000000bbbb33333333333333bbbbbb3333333300000000dddddd9999999999888888888833333300000000
222211111111111133330000000000000000000000000000bbbbbb3333333333bbbbbbbbbb33333300000000dddddddd99999988888888888888333300000000
221111111111111111330000000000000000000000000000bbbbbbbb333333bbbbbbbbbbbbbb333300000000dddddddddd998888888888888888883300000000
111111111111111111110000000000000000000000000000bbbbbbbbbb33bbbbbbbbbbbbbbbbbb3300000000dddddddddd338888888888888888883300000000
441111111111111111550000000000000000000000000000bbbbbbbb333333bbbbbbbbbbbbbb333300000000dddddddd33333388888888888888333300000000
444411111111111155550000000000000000000000000000bbbbbb3333333333bbbbbbbbbb33333300000000dddddd3333333333888888888833333300000000
444444111111115555550000000000000000000000000000bbbb33333333333333bbbbbb3333333300000000dddd333333333333338888883333333300000000
444444441111555555550000000000000000000000000000bb333333333333333333bb333333333300000000dd33333333333333333388333333333300000000
44444444445555555555000000000000000000000000000033333333333333333333333333333333000000003333333333333333333333333333333300000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333000000003333333333333333333333333333333300000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333000000003333333333333333333333333333333300000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333000000003333333333333333333333333333333300000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333000000003333333333333333333333333333333300000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333000000003333333333333333333333333333333300000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333000000003333333333333333333333333333333300000000
