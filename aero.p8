pico-8 cartridge // http://www.pico-8.com
version 18
__lua__


alt=16

tw=20    //tile width
th=tw/2  //tile height
htw=tw/2 //half tile width
hth=th/2 //half tile height
xzero=63 //center pixel


tiles={
 {1,1,1,1,1,1},
 {1,0,0,0,0,1},
 {1,0,0,0,0,1},
 {1,0,0,0,0,1},
 {1,0,0,0,0,1},
 {1,1,1,1,1,1},
}

function iso2screen(x,y)
-- xs = 2x,x
-- ys = -2y,y
-- s  = 2x-2y,x+y
 return xzero+htw*x-htw*y,hth*x+hth*y
end

function screen2iso(sx,sy)
 sx-=xzero
 --local x,y=sx/htw,sy/hth
 --return flr((x+y)/2),flr((y-x)/2)
 local x,y=sx/tw,sy/th
 return flr(x+y),flr(y-x)
end

function _init()
 init_mouse()
end

function _draw()

 cls()
 
 
 
 
 
 --a little faster
-- for x=0,63 do
--  for y=0,127 do
--   tx,ty=screen2iso(x*2,y)
--   srand(tx+ty*100)
--   srand(tx+ty*100)
--   poke(0x6000+x+y*64,rnd(256))
--  end
-- end
 
 if (testmode==nil) testmode=true
 if (btnp(❎)) testmode=not testmode
 
 if testmode then
 
	 for x=0,127 do
	  for y=0,64 do --half screen for more fps for now
	   tx,ty=screen2iso(x,y)
	   srand(tx+ty*100)
	   pset(x,y,rnd(16))
	  end
	 end
 
 else
 
	 for x=1,#tiles do
	  for y=1,#tiles[1] do
	   local sx,sy=iso2screen(x-1,y-1)
	   spr(7,sx-htw,sy,3,3)
	  end
	 end
	 
 end
 
-- 
-- 
-- for x=0,8 do
--  for y=0,8 do
--   spr(2,x*16,y*16,2,2)
--  end
-- end
-- 
---- pal(11,12)
---- for x=0,8 do
----  for y=0,8 do
----   spr(64,x*16,y*16-alt,2,2)
----  end
---- end
---- pal()
--
-- if (btnp(⬆️)) alt+=1
-- if (btnp(⬇️)) alt-=1
--
-- spr(100,64,64,2,2)
-- spr(98,64,64-alt,2,2)
-- 
-- if alt>8 then
----  spr(96,64,64-8,2,\
--  rectfill2(64+7-1,64+7-10,3,3,9)
--  pset(64+7,64+7,9)
--  pset(64+7,64+7-2,9)
--  pset(64+7,64+7-4,9)
--  pset(64+7,64+7-6,9)
----  line(64+7,64+7-3,64+7,64+7-4)
----  line(64+7,64+7-1,64+7,64+7)
-- end
 rectfill(0,0,30,30,14)
 color(1)
 local mx,my=get_mouse()
 local tx,ty=screen2iso(mx,my)
 print(mx..","..my)
 print(tx..","..ty)
 spr(16,mx,my)
 
 print(stat(1))
 print(stat(7))

end


function rectfill2(x,y,w,h,c)
 rectfill(x,y,x+w-1,y+h-1,c)
end
-->8
--mouse

--mouse down coords
mdx=0
mdy=0
mdrag = false

-- middle or even right mouse
-- clicks might be iffy on web?
lmwasdown=false
rmwasdown=false
mmwasdown=false

function init_mouse()
 poke(0x5f2d, 1) --enable mouse
end

function get_mouse()
 return stat(32)-1, stat(33)-1
end

function cache_mouse_state()
 --for mouse edge triggers
 lmwasdown=lmouse()
	rmwasdown=rmouse()
	mmwasdown=mmouse()
end

function nmouse() return stat(34)==0 end
function lmouse() return stat(34)==1 end
function rmouse() return stat(34)==2 end
function mmouse() return stat(34)==4 end

function lmup() return not lmouse() and lmwasdown end
function rmup() return not rmouse() and rmwasdown end
function mmup() return not mmouse() and mmwasdown end

function lmdown() return lmouse() and not lmwasdown end
function rmdown() return rmouse() and not rmwasdown end
function mmdown() return mmouse() and not mmwasdown end

--can delete
function debug_print_mouse()
 print(mx)
 print(my)
 print("lmup"..tostr(lmup()))
 print("lmdown"..tostr(lmdown()))
 print("lmouse"..tostr(lmouse()))
end
-->8
--util



function near(num)
 if num>0 then return flr(num+0.5) 
 else return ceil(num-0.5) 
 end
end
__gfx__
0000000000000000bb333333333333330000000000000000000000000000000000bb000000000000000000001111111111002222222222000000000000000000
000000000000880033bb3333333333bb00000000000000000000000000000000bb33bb0000000000000000001111111100000022222222000000000000000000
00700700800088003333bb333333bb33000000000000000000000000000000bb333333bb00000000000000001111110000000000222222000000000000000000
0007700021122226333333bb33bb33330000000000000000000000000000bb3333333333bb000000000000001111000000000000002222000000000000000000
000770008222882633333333bb33333300000000bb0000000000000000bb33333333333333bb0000000000001100000000000000000022000000000000000000
0070070080008800333333bb33bb3333000000bb33bb000000000000bb3333333333333333333300000000000000000000000000000000000000000000000000
00000000000088003333bb333333bb330000bb333333bb0000000000003333333333333333330000000000003300000000000000000044000000000000000000
000000000000000033bb3333333333bb00bb3333333333bb00000000000033333333333333000000000000003333000000000000004444000000000000000000
7777000000000000bb33333333333333bb33333333333333bb000000000000333333333300000000000000003333330000000000444444000000000000000000
700000000000000033bb3333333333bb00bb3333333333bb00000000000000003333330000000000000000003333333300000044444444000000000000000000
70000000000000003333bb333333bb330000bb333333bb0000000000000000000033000000000000000000003333333333004444444444000000000000000000
7000000000000000333333bb33bb3333000000bb33bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000033333333bb33333300000000bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000333333bb33bb3333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000003333bb333333bb33000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000033bb3333333333bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000bb0000000000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000bb000000bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000bb00bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000bb00bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000bb000000bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000bb0000000000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000bb0000000000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000bb000000bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000bb00bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000bb00bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000bb000000bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000bb0000000000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bb0000000000bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000bb000000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000bb00bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000bb00bb00000000088800660000000088880066000000000000000000000000000000000000000880000000000000088000066600000000000000000000
0000bb000000bb000000008880266000000000882226600000000880000220000000088002200000000888800220000000088880022600000000000000000000
00bb0000000000bb0000000822226000000000222226600000000008822000000000000880000000000008822220000000000882222600000000000000000000
bb000000000000000000080222880000000022222800000000000002288000000000022008800000000002228880000000080222888000000000000000000000
00bb0000000000bb0000082220888000002222288888000000000220000880000002200000000000000222200888800008282220088880000000000000000000
0000bb000000bb000000008000088000000022000088000000022000000000000000000000000000000220000008800000222000000880000000000000000000
000000bb00bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000088000000000000000000000000000
00000000bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000bb00bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000bb000000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bb0000000000bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000008080000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000002200000088000000110000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000099900000000088222088888000001111101111100000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000999990000000000022228800000000001111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000999990000000000088266600000000001111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000099900000000008888066600000000111101100000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000008800066600000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
